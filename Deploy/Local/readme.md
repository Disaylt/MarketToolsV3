# RU

### Шаги по деплою backend части:

#### Шаг 1 - запуск необходимых элементов в Docker compose.
1. Копируем папку local в удобное для вас место.
2. Заходим в директорию куда вы скопировали файлы и в папке с .yml открываем __cmd__
3. Пишем команду: `docker compose up -d`
4. Далее заходим в контейнер *mongo1*
5. Пишем по очереди следующие команды.
6. `mongosh`
7. 
```
rs.initiate({
	_id: "rs0",
	members: [
	   {_id: 0, host: "mongo1", priority: 2},
	   {_id: 1, host: "mongo2", priority: 0},
	   {_id: 2, host: "mongo3", priority: 0}
	]})
```
8. Перед проверкой подождите ~5-10 секунд. С помощью команды `rs.status()`, проверяем что мы создали реплика сет, где mongo1 является основной.
9. На это настройка докера окончена.

#### Шаг 2 - определение конфиг файлов.

*В проекте **MarketToolsV3.ConfigurationManager** можно подробнее ознакомиться с возможностями и настройкой конфигурации для каждого сервиса.*

Для запуска любого из проектов(В том числе AppHost) необходимо в секреты добавить следующий **json**, секреты можно открыть через менеджер секретов **Visual studio**:
```
{
  "Parameters": {
    "ConfigType": "json",
    "JsonBasePath": "Путь до папки с файлами config.json"
  }
}
```

#### Шаг 3 - Миграции.

Миграции можно выполнить как командами через ef.tools так и через специально приложение - **MarketToolsV3.DbMigrations.Service**. Данное приложение выполнит миграции базы данных для всех сервисов. Оно уже встроено в **AppHost** и выполнит все необходимые миграции при запуске.

*!Если у вас еще не существует базы данных, то при первом подключении **EF.Core** выдаст ошибку. В данном случае на неё не стоит обращать внимания, так как он всё равно выполнит миграцию.*

*!В продакшен среде вам не стоит использовать данный сервис.*

#### Шаг 4 - Запуск.

Если вы настроили всё правильно, то вам необходимо запустить *AppHost*, который сбилдит и запустит все необходимые микросервисы. Далее вам останется только запустить фронтенд часть.